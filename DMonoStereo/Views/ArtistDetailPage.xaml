<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:DMonoStereo.ViewModels"
             xmlns:converters="clr-namespace:DMonoStereo.Converters"
             xmlns:views="clr-namespace:DMonoStereo.Views"
             x:Class="DMonoStereo.Views.ArtistDetailPage"
             x:DataType="views:ArtistDetailPage"
             Title="Ð˜ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒ"
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:ByteArrayToImageSourceConverter x:Key="ByteArrayToImageSourceConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            <Border Style="{StaticResource CardStyle}" BackgroundColor="{DynamicResource CardBackgroundColor}">
                <VerticalStackLayout Spacing="20">
                    <Label x:Name="ArtistNameLabel"
                           FontSize="24"
                           FontAttributes="Bold"
                           HorizontalOptions="Fill"
                           HorizontalTextAlignment="Center"
                           LineBreakMode="WordWrap" />

                    <Border x:Name="ArtistCoverBorder"
                            WidthRequest="140"
                            HeightRequest="140"
                            Padding="0"
                            BackgroundColor="{DynamicResource PageBackgroundColor}"
                            HorizontalOptions="Center"
                            IsVisible="False">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="15" />
                        </Border.StrokeShape>
                        <Image x:Name="ArtistCoverImage"
                               Aspect="AspectFill" />
                    </Border>

                    <Grid ColumnDefinitions="Auto,*"
                          RowDefinitions="Auto,Auto,Auto,Auto"
                          ColumnSpacing="12"
                          RowSpacing="6">
                        <Label Text="ÐšÐ¾Ð»-Ð²Ð¾ Ð°Ð»ÑŒÐ±Ð¾Ð¼Ð¾Ð²:"
                               FontSize="14"
                               TextColor="{DynamicResource SecondaryTextColor}" />
                        <Label Grid.Column="1"
                               Text="{Binding AlbumCount}"
                               FontSize="14"
                               FontAttributes="Bold" />

                        <Label Grid.Row="1"
                               Text="ÐšÐ¾Ð»-Ð²Ð¾ Ñ‚Ñ€ÐµÐºÐ¾Ð²:"
                               FontSize="14"
                               TextColor="{DynamicResource SecondaryTextColor}" />
                        <Label Grid.Row="1"
                               Grid.Column="1"
                               Text="{Binding TrackCount}"
                               FontSize="14"
                               FontAttributes="Bold" />

                        <Label Grid.Row="2"
                               Text="Ð¡Ñ€. Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð°Ð»ÑŒÐ±Ð¾Ð¼Ð¾Ð²:"
                               FontSize="14"
                               TextColor="{DynamicResource SecondaryTextColor}" />
                        <Label Grid.Row="2"
                               Grid.Column="1"
                               Text="{Binding AverageAlbumRating, StringFormat='{}{0:F2}', TargetNullValue='-'}"
                               FontSize="14"
                               FontAttributes="Bold" />

                        <Label Grid.Row="3"
                               Text="Ð¡Ñ€. Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ñ‚Ñ€ÐµÐºÐ¾Ð²:"
                               FontSize="14"
                               TextColor="{DynamicResource SecondaryTextColor}" />
                        <Label Grid.Row="3"
                               Grid.Column="1"
                               Text="{Binding AverageTrackRating, StringFormat='{}{0:F2}', TargetNullValue='-'}"
                               FontSize="14"
                               FontAttributes="Bold" />
                    </Grid>

                    <VerticalStackLayout Spacing="10">
                        <Button Text="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"
                                Style="{StaticResource SecondaryButtonStyle}"
                                HorizontalOptions="Fill"
                                Clicked="OnEditArtistClicked" />
                        <Button Text="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                BackgroundColor="{DynamicResource ErrorColor}"
                                TextColor="{DynamicResource PrimaryTextColor}"
                                HorizontalOptions="Fill"
                                Clicked="OnDeleteArtistClicked" />
                        <Button Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð°Ð»ÑŒÐ±Ð¾Ð¼"
                                Style="{StaticResource PrimaryButtonStyle}"
                                HorizontalOptions="Fill"
                                Clicked="OnAddAlbumClicked" />
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

            <Label Text="ÐÐ»ÑŒÐ±Ð¾Ð¼Ñ‹"
                   Style="{StaticResource SectionTitleStyle}" />

            <Picker x:Name="SortPicker"
                    ItemsSource="{Binding SortOptions}"
                    SelectedItem="{Binding SelectedSortOption}"
                    ItemDisplayBinding="{Binding DisplayName}"
                    Title="Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ°"
                    SelectedIndexChanged="OnSortOptionChanged" />

            <CollectionView ItemsSource="{Binding Albums}"
                            SelectionMode="Single"
                            SelectionChanged="OnAlbumSelected">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="15" />
                </CollectionView.ItemsLayout>
                <CollectionView.EmptyView>
                    <Label Text="Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð°Ð»ÑŒÐ±Ð¾Ð¼"
                           TextColor="{DynamicResource SecondaryTextColor}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="viewModels:AlbumViewModel">
                        <Border StrokeThickness="0" BackgroundColor="{DynamicResource CardBackgroundColor}" Padding="15">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="15" />
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                                <Border Grid.Column="0"
                                        WidthRequest="72"
                                        HeightRequest="72"
                                        Padding="0"
                                        BackgroundColor="{DynamicResource PageBackgroundColor}">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="15" />
                                    </Border.StrokeShape>
                                    <Image Source="{Binding CoverImage, Converter={StaticResource ByteArrayToImageSourceConverter}}"
                                           Aspect="AspectFill" />
                                </Border>

                                <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                    <Label Text="{Binding Name}" FontAttributes="Bold" FontSize="18" />
                                    <Label Text="{Binding Year, StringFormat='Ð“Ð¾Ð´: {0}'}"
                                           FontSize="14"
                                           TextColor="{DynamicResource SecondaryTextColor}">
                                        <Label.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding Year}" Value="{x:Null}">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                    <Label Text="{Binding TrackCount, StringFormat='Ð¢Ñ€ÐµÐºÐ¾Ð²: {0}'}" FontSize="14" TextColor="{DynamicResource SecondaryTextColor}" />
                                </VerticalStackLayout>

                                <VerticalStackLayout Grid.Column="2"
                                                     Spacing="2"
                                                     HorizontalOptions="End"
                                                     VerticalOptions="Center">
                                    <Label Text="{Binding Rating, StringFormat='ðŸ’¿ {0:F2}'}"
                                           FontAttributes="Bold"
                                           FontSize="16"
                                           HorizontalOptions="End"
                                           IsVisible="{Binding HasRating}">
                                    </Label>
                                    <Label Text="{Binding AverageTrackRating, StringFormat='â™ª {0:F2}'}"
                                           FontSize="14"
                                           TextColor="{DynamicResource SecondaryTextColor}"
                                           HorizontalOptions="End"
                                           IsVisible="{Binding HasAverageTrackRating}" />
                                </VerticalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>